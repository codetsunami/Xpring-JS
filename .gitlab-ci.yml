stages:
  - test

.test:
  image: node:12-alpine
  stage: test
  before_script:
    - apk add bash git
    - npm i --cache .npm --prefer-offline --no-audit --progress=false nyc codecov protoc
    - npm i --cache .npm --prefer-offline --no-audit --progress=false
    - git submodule update --init --recursive

compile typescript:
  stage: test
  extends: .test
  script:
    - npm run build

run tests:
  stage: test
  extends: .test
  script:
    - ./node_modules/nyc/bin/nyc.js npm test

code coverage:
  stage: test
  extends: .test
  script:
    - ./node_modules/nyc/bin/nyc.js report --reporter=text-lcov
